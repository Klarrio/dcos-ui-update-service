version: '3'
services:
  dcos-ui:
    build: 
      context: .
      dockerfile: Dockerfile.dev
    ports:
      - 5000:5000
    volumes:
      - .:/src
      - ./testdata/docroot:/opt/mesosphere/active
      - ./fixtures/multi-master:/opt/mesosphere/etc/master_count
    command: ["rerun", "-v", "--config=rerun.json"]
    networks:
      default:
        aliases:
         - leader.mesos
  cluster:
    build:
      context: ./testdata/clusterProxy
      dockerfile: Dockerfile
    ports:
      - 6000:6000
    volumes:
      - ./testdata/clusterProxy:/opt/app
      - /opt/app/node_modules
    environment:
      - CLUSTER_URL
      - AUTH_TOKEN
    command: ["npm", "start"]    
  zookeeper:
    image: jplock/zookeeper:3.4.13
    ports:
      - "2181:2181"
    logging:
      driver: none
  nginx:
    image: nginx:latest
    ports:
      - 8080:80
    volumes:
      - ./testdata/nginx/default.conf:/etc/nginx/conf.d/default.conf
      - ./testdata/docroot:/opt/mesosphere/active
 